<!DOCTYPE HTML><html lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)"><title>Build OpenCV for Visual Studio | Unbinilium&#39;s üìù</title><link rel="preload" href="/css/style.css" as="style"><link rel="preload" href="/js/mathjax-loader.js" as="script"><link rel="preload" href="/js/mermaid-loader.js" as="script"><meta name="author" content="Unbinilium"><meta name="description" content="Unbinilium&#39;s draft papers, also the personal weblog"><meta property="og:title" content="Build OpenCV for Visual Studio"><meta property="og:site_name" content="Unbinilium&#39;s üìù"><link rel="stylesheet" href="/css/style.css"><script src="/js/mathjax-loader.js" defer></script><script src="/js/mermaid-loader.js" defer></script><link rel="shortcut icon" href="/css/images/favicon.png"><meta name="generator" content="Hexo 5.4.0"></head><body><header id="header" class="inner"><div class="alignleft"><h1 translate="no"><a href="/">Unbinilium&#39;s üìù</a></h1><h2><a href="/">My draft papers, also the personal weblog</a></h2></div><nav id="main-nav" class="alignright"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article id="post-build-opencv-for-visual-studio" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div class="post-content"><header><time class="dt-published" datetime="2020-10-12T00:00:00.000Z"><a href="">2020-10-12</a></time><h1 class="p-name title" itemprop="headline name">Build OpenCV for Visual Studio</h1></header><div class="e-content entry" itemprop="articleBody"><p>Visual Studio is a full-featured IDE to code, debug, test, and deploy to any platform.</p><p>OpenCV is a library of programming functions mainly aimed at real-time computer vision and it officially compiled without support for NVIDIA CUDA, INTEL TTB and OpenCL library, that‚Äôs why we need to rebuild OpenCV with a custom configuration manually.</p><span id="more"></span><p><em>CUDA is a parallel computing platform and programming model developed by Nvidia for general computing on its own GPUs (graphics processing units). CUDA enables developers to speed up compute-intensive applications by harnessing the power of GPUs for the parallelizable part of the computation.</em></p><p><em>Intel TBB (Threading Building Blocks) makes parallel performance and scalability accessible to software developers who are writing loop- and task-based applications. Build robust applications that abstract platform details and threading mechanisms while achieving performance that scales with increasing core count.</em></p><p>To begin with, these software libraries should be pre-installed and <strong>configured correctly</strong>:</p><ul><li><a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/vs/">Visual Studio Community</a> 2019 or later with <code>Desktop development with C++</code> workload installed</li><li><a target="_blank" rel="noopener" href="https://cmake.org/download/">CMake (cmake-gui)</a> 3.5 or later with <code>Path</code> configured</li><li><a target="_blank" rel="noopener" href="https://www.nvidia.com/Download/index.aspx">NVIDIA GPU Driver</a> 436 or later with <code>Path</code> configured</li><li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-toolkit">NVIDIA GPU Computing Toolkit</a> 10 or later with <code>Path</code> configured</li><li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/nvidia-video-codec-sdk/download">NVIDIA Video Codec SDK</a> 9.1 or later and copy to <em>NVIDIA GPU Computing Toolkit</em> install path</li><li><a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/vs/">Intel Threading Building Blocks</a> 2019 or later with <code>Path</code> configured</li><li><a target="_blank" rel="noopener" href="https://www.python.org/downloads/">Python3.7</a> or later with <code>Path</code> configured</li></ul><p>If there‚Äôs a Anaconda user, make sure Anaconda is your default Python. You can also try tick <em>Register Anaconda as my default Python</em> button when installing Anaconda.</p><ul><li><a target="_blank" rel="noopener" href="https://www.anaconda.com/">Anaconda3</a> 2019 or later <code>Path</code> configured</li></ul><p>To accelerate C++ build speed, try Ninja build system as optional software:</p><ul><li><a target="_blank" rel="noopener" href="https://ninja-build.org/">Ninja build system</a> 1.9.0 or later with <code>Path</code> configured</li></ul><p>For system, I recommend you at least meet the minimal requirements below:</p><ul><li>CPU: Core i7 9750H or higher</li><li>RAM: 8G DDR4 or bigger</li><li>STROAGE: 60GB or bigger</li><li>NETWORK: 10Mbps or higher with no dependencies‚Äô host blocked or proxy passthrough</li></ul><p>Then download both OpenCV and OpenCV Contrib same version source from Github release and <strong>unzip</strong> them after download finished with <strong>MD5 checked</strong>.</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/releases">OpenCV</a> 4.5 or later</li><li><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib/releases">OpenCV Contrib</a> 4.5 or later</li></ul><p>To compile by MSBuild with CMake configured, <strong>open CMake-GUI</strong> first. Firstly click <em>Browse Source</em> button, select path to the folder <strong>OpenCV</strong> unzipped folder. Secondly click <em>Browse Build</em>, create a folder named <code>build</code> in the path to the folder <strong>OpenCV</strong> unzipped folder, then select path to the <code>build</code> folder. For example the path should be like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Where is the source code: C</span><br><span class="line">Where to build the binaries: C:/opencv/build</span><br></pre></td></tr></table></figure><p>Click <em>Configure</em> button then it pop-up a window, you have to change <strong>Specify the generator for the project</strong> to <em>Visual Studio XX 20XX</em> (See the newest Visual Studio you have installed, If you want to use Ninja to accelerate build you have to set generator to <em>Ninja</em>) and keep other selection as default if it had already configured.</p><p>Then click <em>Finish</em> button. The missing or unconfigured part will covered with <strong>RED background</strong>, the other error is in <strong>RED text in output window</strong>, click <em>Configure</em> button again to check if it solved.</p><p>Next we add <code>OPEVCV_EXTRA_MODULES_PATH</code> with path to the folder <strong>OpenCV Contrib</strong> unzipped, use the <strong>modules</strong> folder <code>~/modules</code>, for example my own path listed here:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/opencv_contrib/modules</span><br></pre></td></tr></table></figure><p>Next click <em>Configure</em> button again and <strong>fix missing path</strong> or <strong>any error</strong> until there is no errors displayed.</p><p>When finished default build configuration, it‚Äôs time to <strong>add our custom configuration</strong>. Use <code>Search</code> bar which located on the top of CMake-GUI to search flags <code>WITH_CUDA</code>, <code>WITH_TBB</code> and <code>WITH_OPENGL</code>, all tick selected(If you want to build OpenCV Python version, tick <code>OPENCV_PYTHON3_VERSION</code> selected).</p><p>Since NVIDA Developer removed <em>cudacodec</em>, for <em>OpenGL</em> support you have to unzip <em>NVIDIA Video Codec SDK</em>, then rename <code>Lib</code> folder to <code>lib</code> and copy <code>include</code> &amp; <code>lib</code> folder to <em>NVIDIA GPU Computing Toolkit</em> install path like:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.X</span><br></pre></td></tr></table></figure><p>Last you have to tick <code>WITH_NVCUVID</code> selected in <em>CMake-GUI</em>.</p><p>Then click <em>Configure</em> button again and find error the RED background covered. Generally the Intel TBB install path is like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files(x86)\IntelSWTools\compilers_and_libraries\windows</span><br></pre></td></tr></table></figure><p>The configurations example here:</p><ul><li>TBB_DIR</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\IntelSWTools\compilers_and_libraries\windows\redist\intel64_win\tbb\vc_mt</span><br></pre></td></tr></table></figure><ul><li>TBB_ENV_INCLUDE</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\IntelSWTools\compilers_and_libraries\windows\tbb\include</span><br></pre></td></tr></table></figure><ul><li>TBB_ENV_LIB</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/tbb/lib/intel64/vc_mt/tbb.lib</span><br></pre></td></tr></table></figure><ul><li>TBB_ENV_LIB_DEBUG</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/tbb/lib/intel64/vc_mt/tbb_debug.lib</span><br></pre></td></tr></table></figure><ul><li>TBB_VER_FILE (If TBB_DIR not found)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Program Files (x86)/IntelSWTools/compilers_and_libraries/windows/tbb/include/tbb/tbb_stddef.h</span><br></pre></td></tr></table></figure><p>Next click <em>Configure</em> button again and <strong>fix missing path or error</strong> until there is <strong>no error</strong> in output as RED background covered. Now click <em>Generate</em> button to generate <code>INSTALL.vcxproj</code> in folder <code>~\opencv\build</code> and make there‚Äôs no error displayed.</p><p>Now we start build with <code>MSBuild</code> and we‚Äôd better declare how many CPU cores in order to increase build speed. Firstly we open <strong>CMD</strong> and enter command:</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic cpu get NumberOfLogicalProcessors</span><br></pre></td></tr></table></figure><p>And the outputs like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NumberOfLogicalProcessors</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p>It means we have <code>12 logical processor</code> for compiling if 1 thread uses 1 logical processor. Secondly we open <strong>xXX Native Tools Command Prompt for VS 20XX</strong> and use <code>cd &lt;~\opencv\build&gt;</code> to enter <code>build</code> folder. For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\opencv\build</span><br></pre></td></tr></table></figure><p>Then build OpenCV for <code>RELEASE</code> use command:</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msbuild INSTALL.vcxproj /m:<span class="number">12</span> /p:Configuration=Release</span><br></pre></td></tr></table></figure><p>The arguments <code>/m:12</code> means use 12 threads to build. Be patient, it takes a long time to build.</p><p>At last the build finished and shows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">9232 Warning(s)</span><br><span class="line">0 Error(s</span><br><span class="line">Time Elapsed 02:06:53.91</span><br></pre></td></tr></table></figure><p>Don‚Äôt mind the Warnings. Take a look in folder<code>~\opencv\build\install</code>, all the compiled files here are ready to use. Just set up OpenCV variables path in your VS project and build you project with <strong>Release</strong> Windows Local Debugger.</p><p>Add <code>.lib</code> may be annoying, try command:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> <span class="string">&#x27;~\opencv\install\x64\vc16\lib&#x27;</span> | <span class="built_in">Select-Object</span> <span class="literal">-Property</span> Name</span><br></pre></td></tr></table></figure><p>In <strong>PowerShell</strong> and copy it when editing <strong>Property Pages-&gt;Linker-&gt;Input-&gt;Additional Dependencies</strong> in Visual Studio project.</p></div><footer><div class="tags" translate="no"><a href="../../../../tags/OpenCV/">OpenCV</a>, <a href="../../../../tags/IDE/">IDE</a>, <a href="../../../../tags/Windows/">Windows</a></div><div class="clearfix"></div></footer></div></article></div></div><aside id="sidebar" class="alignright"><div class="widget tag"><h3 class="title">Tags</h3><ul class="entry" translate="no"><li><a href="../../../../tags/About/">About</a> <small>1</small></li><li><a href="../../../../tags/C/">C++</a> <small>1</small></li><li><a href="../../../../tags/IDE/">IDE</a> <small>2</small></li><li><a href="../../../../tags/Linux/">Linux</a> <small>1</small></li><li><a href="../../../../tags/Machine-Learning/">Machine Learning</a> <small>1</small></li><li><a href="../../../../tags/OpenCV/">OpenCV</a> <small>4</small></li><li><a href="../../../../tags/Parallel-Programming/">Parallel Programming</a> <small>1</small></li><li><a href="../../../../tags/Windows/">Windows</a> <small>1</small></li><li><a href="../../../../tags/macOS/">macOS</a> <small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner" translate="no"><div class="alignleft">&copy; 2021 Unbinilium</div><div class="clearfix"></div><script src="/js/sidebar-wrapper.js" async></script><script src="/js/code-notranslate.js" async></script></footer></body></html>